!function(t){var e={};function n(s){if(e[s])return e[s].exports;var i=e[s]={i:s,l:!1,exports:{}};return t[s].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,s){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(s,i,function(e){return t[e]}.bind(null,i));return s},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=11)}([function(t,e,n){"use strict";function s(t,n){return Object.keys(e.defaultFormatting).every(e=>t[e]===n[e])}function i(t){const n={text:t.text};return Object.keys(e.defaultFormatting).forEach(s=>{const i=t[s];i&&i!==e.defaultFormatting[s]&&(n[s]=i)}),n}function r(t){return"string"==typeof t?t.length:1}function o(t){return"string"==typeof t?t:"_"}function*l(t,e,n){if(0!==n)if("string"!=typeof t)if(Array.isArray(t)){let s=0;for(const i of t){if(n<=0)break;const t=r(i);if(s+t>e)if("string"==typeof i){const t=i.substr(Math.max(0,e-s),n);yield t,n-=t.length}else yield i,n-=1;s+=t}}else yield t;else yield t.substr(e,n)}Object.defineProperty(e,"__esModule",{value:!0}),e.defaultFormatting={size:16,font:"sans-serif",color:"black",bgcolor:"transparent",bold:!1,italic:!1,underline:!1,strikeout:!1,align:"left",script:"normal",url:""},e.multipleValues={},e.sameFormatting=s,e.clone=i,e.merge=function(t,n){const s={};return Object.keys(e.defaultFormatting).forEach(i=>{(i in t||i in n)&&(t[i]===n[i]?s[i]=t[i]:s[i]=e.multipleValues)}),s.url=t.url||n.url,s},e.format=function t(n,s){Array.isArray(n)?n.forEach(e=>{t(e,s)}):Object.keys(s).forEach(t=>{s[t]!==e.multipleValues&&(n[t]=s[t])})},e.consolidate=function*(t){let e;for(const n of t)e&&s(e,n)&&"string"==typeof e.text&&"string"==typeof n.text?e.text+=n.text:(e=i(n),yield e)},e.getPlainText=function(t){if("string"==typeof t.text)return t.text;if(Array.isArray(t.text)){const e=[];return t.text.forEach(t=>{e.push(o(t))}),e.join("")}return"_"},e.getPieceLength=r,e.getPiecePlainText=o,e.getTextLength=function(t){if("string"==typeof t)return t.length;if(Array.isArray(t)){let e=0;return t.forEach(t=>{e+=r(t)}),e}return 1},e.getSubText=l,e.getTextChar=function(t,e){return l(t,e,1).next().value}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(t,e,n,s){this.l=t,this.t=e,this.w=n,this.h=s,this.w=n,this.h=s,this.r=t+n,this.b=e+s}contains(t,e){return t>=this.l&&t<this.r&&e>=this.t&&e<this.b}stroke(t){t.strokeRect(this.l,this.t,this.w,this.h)}fill(t){t.fillRect(this.l,this.t,this.w,this.h)}offset(t,e){return new s(this.l+t,this.t+e,this.w,this.h)}equals(t){return this.l===t.l&&this.t===t.t&&this.w===t.w&&this.h===t.h}center(){return{x:this.l+this.w/2,y:this.t+this.h/2}}}e.default=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(0);function i(t){let e=t&&t.size||s.defaultFormatting.size;if(t)switch(t.script){case"super":case"sub":e*=.8}return(t&&t.italic?"italic ":"")+(t&&t.bold?"bold ":"")+" "+e+"px "+(t&&t.font||s.defaultFormatting.font)}function r(t,e){t.fillStyle=e&&e.bgcolor||s.defaultFormatting.bgcolor}function o(t,e){t.fillStyle=e&&e.color||s.defaultFormatting.color,t.font=i(e)}function l(t){t.textAlign="left",t.textBaseline="alphabetic"}function a(t){const e=["font: ",i(t),"; color: ",t&&t.color||s.defaultFormatting.color];if(t)switch(t.script){case"super":e.push("; vertical-align: super");break;case"sub":e.push("; vertical-align: sub")}return e.join("")}e.getFontString=i,e.applyRunBackgroundStyle=r,e.applyRunStyle=o,e.prepareContext=l,e.getRunStyle=a,e.nbsp=String.fromCharCode(160),e.enter=String.fromCharCode(160);class c{constructor(t,e,n){this.width=t,this.ascent=e,this.descent=n,this.height=e+n}}function h(t,n,s){const r=document.createElement("canvas").getContext("2d");r.font=i(n);const o=r.measureText(t);if(o.actualBoundingBoxAscent&&o.actualBoundingBoxDescent)return new c(o.width,o.actualBoundingBoxAscent,o.actualBoundingBoxDescent);const l=document.createElement("span"),a=document.createElement("div"),h=document.createElement("div");a.style.display="inline-block",a.style.width="1px",a.style.height="0",h.style.visibility="hidden",h.style.position="absolute",h.style.top="0",h.style.left="0",h.style.width="2000px",h.style.height="200px",h.appendChild(l),h.appendChild(a),document.body.appendChild(h);try{l.setAttribute("style",s),l.innerHTML="",l.appendChild(document.createTextNode(t.replace(/\s/g,e.nbsp))),a.style.verticalAlign="baseline";const n=a.offsetTop-l.offsetTop;return a.style.verticalAlign="bottom",new c(o&&o.width||l.offsetWidth,n,a.offsetTop-l.offsetTop-n)}finally{h.parentNode.removeChild(h)}}e.Measure=c,e.measureText=h;const d=(()=>{const t=new Map;return function(e,n){const s=a(n),i=s+"<>!&%"+e;let r=t.get(i);return r||(r=h(e,n,s),t.set(i,r)),r}})();e.measure=function(t,e){return d(t,e)},e.draw=function(t,n,s,i,a,c,h,d){switch(l(t),s.script){case"super":a-=h*(1/3);break;case"sub":a+=d/2}s.bgcolor&&(r(t,s),t.fillRect(i,a-h,c,h+d)),o(t,s),t.fillText("\n"===n?e.nbsp:n,i,a),s.underline&&t.fillRect(i,1+a,c,1),s.strikeout&&t.fillRect(i,1+a-h/2,c,1)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(1);class i{constructor(t){this.type=t}children(){return[]}parent(){return null}first(){return this.children()[0]}last(){return this.children()[this.children().length-1]}next(){let t=this;for(;;){const e=t.parent();if(!e)return null;const n=e.children();let s=n[n.indexOf(t)+1];if(s){for(;;){const t=s.first();if(!t)break;s=t}return s}t=e}}previous(){const t=this.parent();if(!t)return null;const e=t.children(),n=e[e.indexOf(this)-1];if(n)return n;const s=t.previous();return s?s.last():null}byOrdinal(t){let e=null;return this.children().some(n=>{if(t>=n.ordinal&&t<n.ordinal+n.length&&(e=n.byOrdinal(t)))return!0})?e:this}byCoordinate(t,e){for(const n of this.children()){if(n.bounds().contains(t,e)){let s=n.byCoordinate(t,e);if(s)return s}}let n=this.last();for(;n;){const t=n.last();if(!t)break;n=t}const s=n.next();return s&&s.block&&(n=s),n}draw(t,e){this.children().forEach(n=>{n.draw(t,e)})}parentOfType(t){const e=this.parent();return e&&(e.type===t?e:e.parentOfType(t))}bounds(t){let e=this._left,n=this._top,i=0,r=0;return this.children().forEach(t=>{const s=t.bounds();e=Math.min(e,s.l),n=Math.min(n,s.t),i=Math.max(i,s.l+s.w),r=Math.max(r,s.t+s.h)}),new s.default(e,n,i-e,r-n)}}e.Node=i;e.GenericNode=class extends i{constructor(t,e,n,s){super(t),this._children=[],this._parent=e,this._left="number"==typeof n?n:Number.MAX_VALUE,this._top="number"==typeof s?s:Number.MAX_VALUE}children(){return this._children}parent(){return this._parent}finalize(t,e){let n=Number.MAX_VALUE,s=0;this._children.forEach(t=>{n=Math.min(n,t.ordinal),s=Math.max(s,t.ordinal+t.length)}),this.ordinal=n-(t||0),this.length=(e||0)+s-n}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(2),i=n(3),r=n(1),o=n(2),l=n(7);class a extends i.Node{constructor(t,e,n,s,i){super(""),this.inline=t,this._parent=e,this.ordinal=n,this.length=s,this.formatting=i,this.measured=t.measure(i)}parent(){return this._parent}draw(t){this.inline.draw(t,this.left,this.baseline,this.measured.width,this.measured.ascent,this.measured.descent,this.formatting)}position(t,e,n){this.left=t,this.baseline=e,n&&(this._bounds=n)}bounds(){return this._bounds||new r.default(this.left,this.baseline-this.measured.ascent,this.measured.width,this.measured.ascent+this.measured.descent)}byCoordinate(t,e){return t<=this.bounds().center().x?this:this.next()}}const c=t=>({eof:!0,measure:t=>new o.Measure(18,0,0),draw:function(t,e,n){},code:t}),h=(new Map).set("number",(t,e)=>{const n=e+1+".";return{measure:t=>s.measure(n,t),draw:(t,e,i,r,o,l,a)=>{s.draw(t,n,a,e,i,r,o,l)},code:t}}).set("listNext",c).set("listEnd",c).set("listStart",(t,e)=>({code:t,block:(e,n,s,o,c,h)=>{const u=new i.GenericNode("list",c,e,n);let f=t,g=h,p=[];const w=function(){const t=new i.GenericNode("item",u),c=d(f.marker||{$:"number"},u.children().length);let h=new a(c,t,o,1,g);h.block=!0;const w=l.frame(p,e+50,n,s-50,o+1,t,h.measured.ascent,0);o=w.ordinal+w.length;const m=w.bounds(),b=w.first(),y=e+50-10-h.measured.width,x=new r.default(e,n,50,m.h);"baseline"in b?h.position(y,b.baseline,x):h.position(y,n+h.measured.ascent,x),n=m.t+m.h,t.children().push(h),t.children().push(w),t.finalize(),u.children().push(t),h=null};return function(t){p.push(t);const e=t.code();if(e){if("listEnd"===e.code.$)return w(),u.finalize(),u;"listNext"===e.code.$&&(p.pop(),w(),p=[],f=e.code,g=t.codeFormatting())}}}}));function d(t,n){const s=e.customCodes&&e.customCodes(t,n);if(s)return s;const i=h.get(t.$);return i&&i(t,n)}e.default=d,e.editFilter=function(t){let e=0;if(!t.words.some((n,s)=>{const i=n.code();if(i)switch(i.code.$){case"listStart":e++;break;case"listNext":if(0===e){const e=n.codeFormatting();return e.text={$:"listStart",marker:i.code.marker},t.spliceWordsWithRuns(s,1,[e]),!0}break;case"listEnd":0===e&&t.spliceWordsWithRuns(s,1,[]),e--}})&&e>0){const n=[];for(;e>0;)e--,n.push({text:{$:"listEnd"}});t.spliceWordsWithRuns(t.words.length-1,0,n)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(2),i=n(2),r=n(4);class o{constructor(){this.code=null}measure(t){const e=s.measure("?",t);return new i.Measure(e.width+4,e.width+2,e.width+2)}draw(t,e,n,s,i,r){t.fillStyle="silver",t.fillRect(e,n-i,s,i+r),t.strokeRect(e,n-i,s,i+r),t.fillStyle="black",t.fillText("?",e+2,n)}}class l{constructor(t,e,n,s){this.run=t,this.isNewLine=e,this.isNewLine=e,this.width=e?0:n.width,this.ascent=n.ascent,this.descent=n.descent,this.code=s}draw(t,e,n){"string"==typeof this.run.text?s.draw(t,this.run.text,this.run,e,n,this.width,this.ascent,this.descent):this.code&&this.code.draw&&(t.save(),this.code.draw(t,e,n,this.width,this.ascent,this.descent,this.run),t.restore())}}e.Part=l,e.part=function(t){let e,n,a;return"string"==typeof t.text?(n=1===t.text.length&&"\n"===t.text[0],e=s.measure(n?s.nbsp:t.text,t)):e=(a=r.default(t.text)||new o).measure?a.measure(t):new i.Measure(0,0,0),new l(t,n,e,a)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.gmap=function*(t,e){for(const n of t)yield e(n)},e.gfoldl=function(t,e){let n=t.next().value;for(const s of t)n=e(n,s);return n},e.gfilter=function*(t,e){for(const n of t)e(n)&&(yield n)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(3),i=n(1),r=n(16);class o extends s.Node{constructor(t,e,n){super("frame"),this.lines=t,this._parent=e,this.ordinal=n}bounds(){if(!this._bounds){let t=0,e=0,n=0,s=0;if(this.lines.length){const i=this.lines[0].bounds();t=i.l,e=i.t,this.lines.forEach(t=>{const e=t.bounds();n=Math.max(n,e.l+e.w),s=Math.max(s,e.t+e.h)})}this._bounds=new i.default(t,e,n-t,this.height||s-e)}return this._bounds}actualWidth(){if(!this._actualWidth){let t=0;this.lines.forEach(e=>{"number"==typeof e.actualWidth&&(t=Math.max(t,e.actualWidth))}),this._actualWidth=t}return this._actualWidth}children(){return this.lines}parent(){return this._parent}draw(t,e){const n=e?e.t:0,s=e?e.t+e.h:Number.MAX_VALUE;this.lines.some(i=>{const r=i.bounds();return!(r.t+r.h<n)&&(r.t>s||void i.draw(t,e))})}}e.Frame=o,e.frame=function(t,e,n,s,i,l,a,c){const h=[],d=new o(h,l,i),u=r.default(t,e,n,s,i,d,a,c);for(const t of u)"number"==typeof t?d.height=t:(d.length=t.ordinal+t.length-i,h.push(t));return d}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(1),i=n(5),r=n(2),o=n(3),l=n(0),a=()=>r.measure(r.enter,l.defaultFormatting).width;class c extends o.Node{constructor(t,e,n,s,i){super("character"),this.left=t,this.part=e,this.word=n,this.ordinal=s,this.length=i}bounds(){const t=this.word.bounds(),e=this.word.word.isNewLine()?a():this.width||this.part.width;return new s.default(t.l+this.left,t.t,e,t.h)}parent(){return this.word}byOrdinal(){return this}byCoordinate(t,e){return t<=this.bounds().center().x?this:this.next()}}e.PositionedChar=c;class h extends o.Node{constructor(t,e,n,s,i){super("word"),this.word=t,this.line=e,this.left=n,this.ordinal=s,this.width=i,this.length=t.text.length+t.space.length}draw(t){this.word.draw(t,this.line.left+this.left,this.line.baseline)}bounds(){return new s.default(this.line.left+this.left,this.line.baseline-this.line.ascent,this.word.isNewLine()?a():this.width,this.line.ascent+this.line.descent)}*parts(){yield*this.word.text.parts,yield*this.word.space.parts}realiseCharacters(){if(!this._characters){const t=[];let e=0;const n=this;let s=this.ordinal;for(const r of this.parts()){const o=o=>{const l=Object.create(r.run);l.text=o;const a=i.part(l);t.push(new c(e,a,n,s,1)),e+=a.width,s++},l=r.run.text;if("string"==typeof l)for(const t of l)o(t);else o(l)}const r=t[t.length-1];r&&(r.width=this.width-r.left,(this.word.isNewLine()||this.word.code()&&this.word.code().eof)&&(r.newLine=!0)),this._characters=t}}children(){return this.realiseCharacters(),this._characters}parent(){return this.line}}e.PositionedWord=h},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(5),i=n(0),r=n(6);class o{constructor(t,e,n){this.text=t,this.space=e,this.softWrap=n,this.ascent=Math.max(t.ascent,e.ascent),this.descent=Math.max(t.descent,e.descent),this.width=t.width+e.width,this.length=t.length+e.length}isNewLine(){return 1===this.text.parts.length&&this.text.parts[0].isNewLine}code(){return 1===this.text.parts.length&&this.text.parts[0].code}codeFormatting(){return 1===this.text.parts.length&&this.text.parts[0].run}draw(t,e,n){const s=s=>{s.draw(t,e,n),e+=s.width};this.text.parts.forEach(s),this.space.parts.forEach(s)}plainText(){return this.text.plainText+this.space.plainText}align(){const t=this.text.parts[0];return t?t.run.align:"left"}*runs(t){let e=t&&t.start||0,n=t&&t.end;void 0===n&&(n=Number.MAX_VALUE);for(const t of[this.text,this.space])for(const s of t.parts){if(e>=n||n<=0)return!0;const t=s.run,i=t.text;if("string"==typeof i){if(e<=0&&n>=i.length)yield t;else if(e<i.length){const s=Object.create(t),r=Math.max(0,e);s.text=i.substr(r,Math.min(i.length,n-r)),yield s}e-=i.length,n-=i.length}else e<=0&&n>=1&&(yield t),e--,n--}}}e.Word=o;class l{constructor(t){this.parts=t,this.ascent=0,this.descent=0,this.width=0,this.length=0,this.plainText="";for(const e of t)this.ascent=Math.max(this.ascent,e.ascent),this.descent=Math.max(this.descent,e.descent),this.width+=e.width,this.length+=i.getPieceLength(e.run.text),this.plainText+=i.getPiecePlainText(e.run.text)}}e.Section=l,e.word=function(t){let e,n;return t?(e=new l([...r.gmap(t.text.cut(t.spaces),s.part)]),n=new l([...r.gmap(t.spaces.cut(t.end),s.part)])):(e=new l([s.part({text:"\n"})]),n=new l([])),new o(e,n,!1)}},function(t,e,n){"use strict";function s(t){for(;t.firstChild;)t.removeChild(t.firstChild)}Object.defineProperty(e,"__esModule",{value:!0}),e.isAttached=function(t){let e=t;for(;e.parentNode;)e=e.parentNode;return!!e.body},e.clear=s,e.setText=function(t,e){s(t),t.appendChild(document.createTextNode(e))},e.handleEvent=function(t,e,n){t.addEventListener(e,t=>{!1===n(t)&&t.preventDefault()})}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(12),i=n(10),r=n(0),o=n(20),l=n(4);if(e.bundle={editor:s,dom:i,runs:r,html:o,codes:l},"undefined"!=typeof window&&window.document){if(window.carota)throw new Error("Something else is called carota!");window.carota=e.bundle}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(13),i=n(10),r=n(1);e.create=function(t){t.innerHTML='<canvas width="100" height="100" class="carotaEditorCanvas" style="position: absolute;"></canvas><div class="carotaTextArea" style="overflow: hidden; position: absolute; height: 0; top: 0"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0; width: 1000px; height: 1em; outline: none; font-size: 4px;"></textarea>',t.style.overflow="hidden";const e=t.querySelector("canvas"),n=t.querySelector(".carotaTextArea"),o=t.querySelector("textarea"),l=new s.CarotaDocument;let a,c=0,h=null,d=null,u=null,f=null,g="",p=null;const w=(new Map).set(66,"bold").set(73,"italic").set(85,"underline").set(83,"strikeout"),m=function(t,e){return e<0?t<=0:t>=l.frame.length-1},b=function(t,e){return t.b<=e.t||e.b<=t.t},y=function(t,e){let n,s=l.getCaretCoords(t);for(d=null!==h?h:s.l;!m(t,e)&&(t+=e,n=l.getCaretCoords(t),!b(n,s)););for(s=n;!m(t,e)&&!(e>0&&n.l>=d||e<0&&n.l<=d);)if(t+=e,n=l.getCaretCoords(t),b(n,s)){t-=e;break}return t},x=function(t,e){const n=l.getCaretCoords(t);let s;for(;!m(t,e);)if(t+=e,s=l.getCaretCoords(t),b(s,n)){t-=e;break}return t};i.handleEvent(o,"keydown",t=>{if(function(t,e,n){let s=l.selection.start,i=l.selection.end;const r=l.frame.length-1;let o=!1;if(d=null,e){if(!c)switch(t){case 37:case 38:case 36:case 33:c=-1;break;case 39:case 40:case 35:case 34:c=1}}else c=0;let u=1===c?i:s,g=!1;switch(t){case 37:if(e||s===i){if(u>0)if(n){const t=l.wordContainingOrdinal(u);u=t.ordinal===u?t.index>0?l.wordOrdinal(t.index-1):0:t.ordinal}else u--}else u=s;g=!0;break;case 39:if(e||s===i){if(u<r)if(n){const t=l.wordContainingOrdinal(u);u=t.ordinal+t.word.length}else u++}else u=i;g=!0;break;case 40:u=y(u,1),g=!0;break;case 38:u=y(u,-1),g=!0;break;case 36:u=x(u,-1),g=!0;break;case 35:u=x(u,1),g=!0;break;case 33:u=0,g=!0;break;case 34:u=r,g=!0;break;case 8:s===i&&s>0&&(l.range(s-1,s).clear(),f=s-1,l.select(f,f),o=!0);break;case 46:s===i&&s<r&&(l.range(s,s+1).clear(),o=!0);break;case 90:n&&(o=!0,l.performUndo());break;case 89:n&&(o=!0,l.performUndo(!0));break;case 65:n&&(o=!0,l.select(0,r));break;case 67:case 88:n&&(a=l.selectedRange().save(),p=l.selectedRange().plainText())}const m=w.get(t);if(n&&m){const t=l.selectedRange();t.setFormatting(m,!0!==t.getFormatting()[m]),_(),o=!0}if(g){switch(c){case 0:s=i=u;break;case-1:s=u;break;case 1:i=u}if(s===i)c=0;else if(s>i){c=-c;const t=i;i=s,s=t}f=u,l.select(s,i),o=!0}return h=d,o}(t.keyCode,t.shiftKey,t.ctrlKey))return!1});const _=()=>{const n=1*t.clientWidth;l.width()!==n&&l.setWidth(n);l.frame.bounds().h;const s=Math.max(1,window.devicePixelRatio||1),i=Math.max(l.frame.actualWidth(),t.clientWidth),a=t.clientHeight;e.width=s*i,e.height=s*a,e.style.width=i+"px",e.style.height=a+"px";const c=e.getContext("2d");c.scale(s,s),l.draw(c,new r.default(0,0,i,a)),l.drawSelection(c,!!u||document.activeElement===o)};o.addEventListener("input",()=>{let t=o.value;g!==t&&(g="",o.value="",t===p&&(t=a),l.insert(t))});const v=()=>{f=null===f?l.selection.end:f;const e=l.byOrdinal(f);if(f=null,e){const n=e.bounds();o.focus();const s=Math.max(0,n.t+n.h-(t.scrollTop+t.clientHeight));s&&(t.scrollTop+=s);const i=Math.max(0,t.scrollTop-n.t);i&&(t.scrollTop-=i);const r=Math.max(0,n.l-(t.scrollLeft+t.clientWidth));r&&(t.scrollLeft+=r);const l=Math.max(0,t.scrollLeft-n.l);l&&(t.scrollLeft-=l)}g=l.selectedRange().plainText(),o.value=g,o.select(),setTimeout(()=>{o.focus()},10)};l.selectionChanged((t,e)=>{_(),u||!1!==e&&v()});const C=(s,i)=>{e.addEventListener(s,e=>{const s=n.getBoundingClientRect(),r=t.style.transform;let o=0;r&&(o=Number.parseFloat(r.match(/rotate\((-?\d*.?\d*)rad\)/)[1]));const a=e.clientX-s.left,c=e.clientY-s.top,h=Math.cos(o),d=Math.sin(o),u=a*h+c*d,f=c*h-a*d;i(l.byCoordinate(u,f)),e.preventDefault()})};C("mousedown",t=>{u=t.ordinal,l.select(t.ordinal,t.ordinal),h=null}),C("dblclick",t=>{(t=t.parent())&&l.select(t.ordinal,t.ordinal+(t.word?t.word.text.length:t.length))}),C("mousemove",t=>{null!==u&&t&&(f=t.ordinal,u>t.ordinal?l.select(t.ordinal,u):l.select(u,t.ordinal))}),C("mouseup",t=>{u=null,h=null,v(),o.focus()});let M=(new Date).getTime(),k=!1,O=t.clientWidth,T=t.clientHeight;const E=function(){let e=!1;const n=document.activeElement===o;k!==n&&(k=n,e=!0);const s=(new Date).getTime();s>M&&(M=s+500,l.toggleCaret()&&(e=!0)),t.clientWidth===O&&t.clientHeight===T||(e=!0,O=t.clientWidth,T=t.clientHeight),e&&_()};return E(),setInterval(E,200),l}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(14),i=n(15),r=n(9),o=n(3),l=n(0),a=n(18),c=n(19),h=n(7),d=n(4),u=n(1),f=n(6),g=n(8),p=(t,e,n,s)=>{const i=t.selection.start,r=t.selection.end;return o=>{t._wordOrdinals=[];const l=t.words.splice(e,n,...s);o(p(t,e,s.length,l)),t._nextSelection={start:i,end:r}}},w=t=>{const e=[];return t(t=>{e.push(t),this.length=e.length}),t=>{t(w(t=>{for(;e.length;)e.pop()(t)}))}},m=t=>{if(t.isNewLine())return!0;const e=t.code();return!(!e||!e.block&&!e.eof)};class b extends o.Node{constructor(){super("document"),this._width=0,this.selection={start:0,end:0},this.caretVisible=!0,this.selectionChanged=c.default(),this.contentChanged=c.default(),this.editFilters=[d.editFilter],this.load([])}load(t,e){this.undo=[],this.redo=[],this._wordOrdinals=[],this.words=[],this.words=[...f.gmap(i.split(s.characters(t)),r.word)],this.layout(),this.contentChanged.fire(),this.select(0,0,e)}layout(){this.frame=null;try{this.frame=h.frame(this.words,0,0,this._width,0,this)}catch(t){console.error(t)}if(this.frame){if(this._nextSelection){const t=this._nextSelection;delete this._nextSelection,this.select(t.start,t.end,!1)}}else console.error("A bug somewhere has produced an invalid state - rolling back"),this.performUndo()}range(t,e){return new a.Range(this,t,e)}documentRange(){return this.range(0,this.frame.length-1)}selectedRange(){return this.range(this.selection.start,this.selection.end)}save(){return this.documentRange().save()}paragraphRange(t,e){const n=this.wordContainingOrdinal(t);if(t=0,n&&!m(n.word))for(let e=n.index;e>0;e--)if(m(this.words[e-1])){t=this.wordOrdinal(e);break}const s=this.wordContainingOrdinal(e);if(e=this.frame.length-1,s&&!m(s.word))for(let t=s.index;t<this.words.length;t++)if(m(this.words[t])){e=this.wordOrdinal(t);break}return this.range(t,e)}insert(t,e){this.select(this.selection.end+this.selectedRange().setText(t),null,e)}modifyInsertFormatting(t,e){this.nextInsertFormatting[t]=e,this.notifySelectionChanged(!1)}applyInsertFormatting(t){const e=this.nextInsertFormatting,n=Object.keys(e);n.length&&t.forEach(t=>{n.forEach(n=>{t[n]=e[n]})})}wordOrdinal(t){if(t<this.words.length){const e=this._wordOrdinals.length;if(e<t+1){let n=e>0?this._wordOrdinals[e-1]:0;for(let s=e;s<=t;s++)this._wordOrdinals[s]=n,n+=this.words[s].length}return this._wordOrdinals[t]}}wordContainingOrdinal(t){let e=0;for(let n=0;n<this.words.length;n++){const s=this.words[n];if(t>=e&&t<e+s.length)return{word:s,ordinal:e,index:n,offset:t-e};e+=s.length}}*runs(t){const e=this.wordContainingOrdinal(Math.max(0,t.start)),n=this.wordContainingOrdinal(Math.min(t.end,this.frame.length-1));if(e.index===n.index)yield*e.word.runs({start:e.offset,end:n.offset});else{yield*e.word.runs({start:e.offset});for(let t=e.index+1;t<n.index;t++)yield*this.words[t].runs();yield*n.word.runs({end:n.offset})}}spliceWordsWithRuns(t,e,n){const o=this,l=[...f.gmap(f.gfilter(i.split(s.characters(n)),t=>!!t),t=>r.word(t))];let a=!1;if("_filtersRunning"in o)o._filtersRunning++;else{for(let n=0;n<e;n++)this.words[t+n].code()&&(a=!0);a||(a=l.some(t=>!!t.code()))}this.transaction(n=>{if(p(o,t,e,l)(n),a){o._filtersRunning=0;try{for(;;){const t=o._filtersRunning;if(!o.editFilters.some(e=>(e(o),t!==o._filtersRunning)))break}}finally{delete o._filtersRunning}}})}splice(t,e,n){let s;if("string"==typeof n){const e=Math.max(0,t-1),i=this.runs({start:e,end:e+1}).next().value;s=[i?Object.create(i,{text:{value:n}}):{text:n}]}else s=Array.isArray(n)?n:[{text:n}];this.applyInsertFormatting(s);const i=this.wordContainingOrdinal(t),r=this.wordContainingOrdinal(e);let o,a;if(t===i.ordinal)if(i.index>0&&!m(this.words[i.index-1])){i.index--,o=[...this.words[i.index].runs()]}else o=[];else o=[...i.word.runs({end:i.offset})];e===r.ordinal?e===this.frame.length-1||m(r.word)?(a=[],r.index--):a=[...r.word.runs()]:a=[...r.word.runs({start:r.offset})];const c=this.frame.length;return this.spliceWordsWithRuns(i.index,r.index-i.index+1,[...l.consolidate(o.concat(s).concat(a))]),this.frame?this.frame.length-c:0}registerEditFilter(t){this.editFilters.push(t)}width(){return this._width}setWidth(t){this._width=t,this.layout(),this.contentChanged.fire()}children(){return[this.frame]}toggleCaret(){const t=this.caretVisible;return this.selection.start===this.selection.end&&(this.selectionJustChanged?this.selectionJustChanged=!1:this.caretVisible=!this.caretVisible),this.caretVisible!==t}getCaretCoords(t){const e=this.byOrdinal(t);if(e){if(t>0){const n=this.byOrdinal(t-1);if(n instanceof g.PositionedChar&&n.word.word.softWrap||e.block){if(n instanceof g.PositionedChar&&n.newLine){const t=n.bounds(),e=n.parent().parent().bounds();return new u.default(e.l,e.b,1,t.h)}{const t=n.bounds();return new u.default(t.r,t.t,1,t.h)}}}const n=e.bounds();return new u.default(n.l,n.t,1,n.h)}}byCoordinate(t,e){return this.frame.byCoordinate(t,e)}drawSelection(t,e){if(this.selection.end===this.selection.start){if(this.selectionJustChanged||e&&this.caretVisible){const e=this.getCaretCoords(this.selection.start);e&&(t.save(),t.fillStyle="black",e.fill(t),t.restore())}}else{t.save(),t.fillStyle=e?"rgba(0, 100, 200, 0.3)":"rgba(160, 160, 160, 0.3)";for(const e of this.selectedRange().parts())e.bounds(!0).fill(t);t.restore()}}notifySelectionChanged(t){let e=null;const n=this;this.selectionChanged.fire((function(){return e||(e=n.selectedRange().getFormatting()),e}),t)}select(t,e,n){this.frame&&(this.selection.start=Math.max(0,t),this.selection.end=Math.min("number"==typeof e?e:this.selection.start,this.frame.length-1),n&&(this.selectionJustChanged=!0),this.caretVisible=!0,this.nextInsertFormatting={},this.notifySelectionChanged(n))}performUndo(t){const e=t?this.redo:this.undo,n=t?this.undo:this.redo,s=e.pop();s&&(s(t=>{n.push(t)}),this.layout(),this.contentChanged.fire())}canUndo(t){return t?!!this.redo.length:!!this.undo.length}transaction(t){if(this._currentTransaction)t(this._currentTransaction);else{const e=this;for(;this.undo.length>50;)e.undo.shift();this.redo.length=0;let n=!1;this.undo.push(w(s=>{e._currentTransaction=s;try{t(s)}finally{n=s.length>0,e._currentTransaction=null}})),n&&(e.layout(),e.contentChanged.fire())}}insertHyperlink(t,e){const n={text:e||t,url:t,underline:!0,color:"#1565C0"};this.selectedRange().setText([n])}}e.CarotaDocument=b},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(0);class i{constructor(t,e,n){this._runs=t,this._run=e,this._offset=n,this.char=e>=t.length?null:s.getTextChar(t[e].text,n)}equals(t){return this._run===t._run&&this._offset===t._offset}*cut(t){for(let e=this._run;e<=t._run;e++){const n=this._runs[e];if(n){const i=e===this._run?this._offset:0,r=e===t._run?t._offset:s.getTextLength(n.text);if(i<r)for(const t of s.getSubText(n.text,i,r-i)){const e=Object.create(n);e.text=t,yield e}}}}}e.Character=i,e.characters=function*(t){for(let e=0;e<t.length;e++)for(let n=0;n<s.getTextLength(t[e].text);n++)yield new i(t,e,n);yield new i(t,t.length,0)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(4);e.split=function*(t){let e,n=null,i=null,r=!0;for(const o of t){if(null===o.char)e=!0;else if(r&&(e=!0,r=!1),"string"==typeof o.char)switch(o.char){case" ":i||(i=o);break;case"\n":e=!0,r=!0;break;default:i&&(e=!0)}else{const t=s.default(o.char);(t.block||t.eof)&&(e=!0,r=!0)}if(e){if(n&&!n.equals(o)&&(yield{text:n,spaces:i||o,end:o},i=null),null===o.char)return void(yield null);n=o,e=!1}}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(17),i=n(9),r=n(5);e.default=function*(t,e,n,o,l,a,c,h){const d=[];let u,f=0,g=0,p=c||0,w=h||0,m=n;function b(t){if(d.push(t),f+=t.width,p=Math.max(p,t.ascent),w=Math.max(w,t.descent),t.isNewLine())return g=t.ascent+t.descent,y()}function y(){const t=new s.Line(a,e,o,m+p,p,w,d,l);return l+=t.length,m+=p+w,d.length=0,f=p=w=0,t}function x(t,e,n){const s=[],o=[];for(const i of t.runs({start:e,end:n}))"string"==typeof i.text&&""===i.text.trim()?o.push(i):s.push(i);return new i.Word(new i.Section(s.map(r.part)),new i.Section(o.map(r.part)),!0)}for(const n of t)if(u){g=0;const t=u(n);t&&(u=null,l+=t.length,m+=t.bounds().h,t.block=!0,yield t)}else{const t=n.code();if(t&&t.block)d.length?yield y():m+=g,u=t.block(e,m,o,l,a,n.codeFormatting()),g=0;else if(g=0,n.width>o){d.length&&(yield y());let t=0,e=0;for(;e<=n.length;){const s=[...n.runs({start:t,end:e})];new i.Section(s.map(t=>r.part(t))).width>o&&(b(x(n,t,e-1)),yield y(),t=e-1),e++}t!=n.length&&b(x(n,t,n.length))}else if(d.length){f+n.text.width>o&&(yield y());const t=b(n);t&&(yield t)}else{const t=b(n);t&&(yield t)}}d.length?(yield y(),yield m-n):yield m+g-n}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(8),i=n(1),r=n(3);class o extends r.Node{constructor(t,e,n,i,r,o,l,a){super("line"),this.doc=t,this.left=e,this.width=n,this.baseline=i,this.ascent=r,this.descent=o,this.ordinal=a,this.align=l[0].align();let c=0;l.forEach(t=>{c+=t.width}),c-=l[l.length-1].space.width;let h=0,d=0;if(c<n)switch(this.align){case"right":h=n-c;break;case"center":h=(n-c)/2;break;case"justify":l.length>1&&!l[l.length-1].isNewLine()&&(d=(n-c)/(l.length-1))}this.positionedWords=l.map(t=>{const e=h;h+=t.width+d;const n=a;return a+=t.text.length+t.space.length,new s.PositionedWord(t,this,e,n,t.width+d)}),this.actualWidth=c,this.length=a-this.ordinal}bounds(t){if(t){const t=this.first().bounds(),e=this.last().bounds();return new i.default(t.l,this.baseline-this.ascent,e.l+e.w-t.l,this.ascent+this.descent)}return new i.default(this.left,this.baseline-this.ascent,this.width,this.ascent+this.descent)}parent(){return this.doc}children(){return this.positionedWords}}e.Line=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(0),i=n(6);e.Range=class{constructor(t,e,n){this.doc=t,this.start=e,this.end=n,this.doc=t,this.start=e,this.end=n,e>n&&(this.start=n,this.end=e)}*parts(t){t=t||this.doc.children();for(const e of t)if(!(e.ordinal+e.length<=this.start)){if(e.ordinal>=this.end)break;e.ordinal>=this.start&&e.ordinal+e.length<=this.end?yield e:yield*this.parts(e.children())}}clear(){return this.setText([])}setText(t){return this.doc.splice(this.start,this.end,t)}plainText(){return[...i.gmap(this.doc.runs(this),s.getPlainText)].join("")}save(){return[...s.consolidate([...this.doc.runs(this)])]}getFormatting(){if(this.start===this.end){let t=this.start;t>0&&t--,this.start=t,this.end=t+1}return i.gfoldl(this.doc.runs(this),s.merge)||s.defaultFormatting}setFormatting(t,e){let n=this;if("align"===t&&(n=n.doc.paragraphRange(n.start,n.end)),n.start===n.end)n.doc.modifyInsertFormatting(t,e);else{const i=n.save(),r={};r[t]=e,s.format(i,r),n.setText(i)}}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){const t=[],e=function(e){t.push(e)};return e.fire=(...e)=>{t.forEach(t=>{t(...e)})},e}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(0),i=function(t,e){return function(n,s){n.nodeName===t&&(s[e]=!0)}},r=function(t,e,n,s){return function(i,r){let o=i[t]&&i[t][e];o&&(s&&(o=s(o)),r[n]=o)}},o=function(t,e,n){return r("attributes",t,e,n)},l=function(t,e,n){return r("style",t,e,n)},a=function(t,e,n){return function(s,i){s.style&&s.style.getPropertyValue(t)===e&&(i[n]=!0)}},c=[6,7,9,10,12,16,20,30],h=["BR","P","H1","H2","H3","H4","H5"],d=["left","center","right","justify"],u=function(t){return d.includes(t)?t:"left"},f=(new Map).set("H1",30).set("H2",20).set("H3",16).set("H4",14).set("H5",12),g=function(t){const e=t.split(/\s*,\s*/g);if(0==e.length)return t;let n=(t=e[0]).match(/^"(.*)"$/);return n?n[1].trim():(n=t.match(/^'(.*)'$/))?n[1].trim():t},p=[i("B","bold"),i("STRONG","bold"),i("I","italic"),i("EM","italic"),i("U","underline"),i("S","strikeout"),i("STRIKE","strikeout"),i("DEL","strikeout"),a("fontWeight","bold","bold"),a("fontStyle","italic","italic"),a("textDecoration","underline","underline"),a("textDecoration","line-through","strikeout"),l("color","color"),l("fontFamily","font",g),l("fontSize","size",t=>{const e=t.match(/^([\d\.]+)pt$/);return e?parseFloat(e[1]):10}),l("textAlign","align",u),function(t,e){"SUB"===t.nodeName&&(e.script="sub")},function(t,e){"SUPER"===t.nodeName&&(e.script="super")},function(t,e){"CODE"===t.nodeName&&(e.font="monospace")},function(t,e){const n=f.get(t.nodeName);n&&(e.size=n)},o("color","color"),o("face","font",g),o("align","align",u),o("size","size",t=>c[t]||10)];e.parse=function(t,e){let n;"string"==typeof t?(n=document.createElement("div")).innerHTML=t:n=t;let i=!0;const r=[],o=function(t,e){r.push(Object.create(e,{text:{value:t}}))},l=(t,n)=>{if(t instanceof HTMLElement){if(n=Object.create(n),t.classList.forEach(t=>{const s=e.get(t);s&&Object.keys(s).forEach(t=>{n[t]=s[t]})}),p.forEach(e=>{e(t,n)}),t.childNodes)for(let e=0;e<t.childNodes.length;e++)l(t.childNodes[e],n);h.includes(t.nodeName)&&(o("\n",n),i=!0)}else!function(t,e){let n=(t=t.replace(/\n+\s*/g," ")).length;t=t.replace(/^\s+/,""),i?i=!1:n!==t.length&&(t=" "+t),(n=t.length)!==(t=t.replace(/\s+$/,"")).length&&(i=!0,t+=" "),o(t,e)}(t.nodeValue,n)};return l(n,{}),[...s.consolidate(r)]}}]);
