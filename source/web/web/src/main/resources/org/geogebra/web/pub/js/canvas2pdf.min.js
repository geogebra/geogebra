/*
 *
 *  A canvas to PDF converter. Uses a mock canvas context to build a PDF document.
 *
 *  Licensed under the MIT license:
 *  http://www.opensource.org/licenses/mit-license.php
 *
 *  Author:
 *  Joshua Gould
 *
 *  @license Copyright (c) 2017 Joshua Gould
*/
!function(t){"use strict";var e=void 0!==e?e:{};t.canvas2pdf=e;const i=new Set,o={},n=[];function r(t,e,i,o){t=t%360+360*(t<0);var n=i+(i<.5?i:1-i)*(e=isNaN(t)||isNaN(e)?0:e),r=2*i-n;return m(s(t>=240?t-240:t+120,r,n),s(t,r,n),s(t<120?t+240:t-120,r,n),o)}function s(t,e,i){return 255*(t<60?e+(i-e)*t/60:t<180?i:t<240?e+(i-e)*(240-t)/60:e)}e.setFontPath=function(t){e.fontPath=t},e.runAfterFontsLoaded=function(t){try{t()}catch(e){console.log("will retry after fonts loaded: "+e),n.push(t)}},e.addFonts=function(t){if(Object.assign(o,t),Object.keys(t).forEach((t=>i.delete(t))),!i.size){const t=[...n];n.splice(0),t.forEach(e.runAfterFontsLoaded)}};var a="\\s*([+-]?\\d+)\\s*",h="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",c="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",p=new RegExp("^rgb\\("+[a,a,a]+"\\)$"),d=new RegExp("^rgb\\("+[c,c,c]+"\\)$"),f=new RegExp("^rgba\\("+[a,a,a,h]+"\\)$"),u=new RegExp("^rgba\\("+[c,c,c,h]+"\\)$"),l=new RegExp("^hsl\\("+[h,c,c]+"\\)$"),g=new RegExp("^hsla\\("+[h,c,c,h]+"\\)$"),m=function(t,e,i,o){return{c:t/255+" "+e/255+" "+i/255,a:o}},y=function(t){if(!t)return{c:"0 0 0",a:1};if(!t.toString().startsWith("rgb")&&!t.toString().startsWith("hsl")){var e=document.createElement("div");e.style.color=t,document.body.appendChild(e),t=window.getComputedStyle(e).color+"",document.body.removeChild(e)}var i,o=((t=t.replace(/\s/g,""))+"").trim().toLowerCase();return(i=p.exec(o))?m(i[1],i[2],i[3],1):(i=d.exec(o))?m(255*i[1]/100,255*i[2]/100,255*i[3]/100,1):(i=f.exec(o))?m(i[1],i[2],i[3],i[4]):(i=u.exec(o))?m(255*i[1]/100,255*i[2]/100,255*i[3]/100,i[4]):(i=l.exec(o))?r(i[1],i[2]/100,i[3]/100):(i=g.exec(o))?r(i[1],i[2]/100,i[3]/100,i[4]):{c:t,a:1}};
/*
	@license MIT LICENSE
	Copyright (c) 2014 Devon Govett

	Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

	The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

	THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
	*/
function x(){this.objects=[],this.catalog=this.add(new P),this.pages=this.add(new b),this.catalog.setPages(this.pages),this.pageWidth=8.27,this.pageHeight=11.69,this.textStyle=new A,this.fonts=[],this.lineWidth=1,this.lineEndType=0,this.alpha=1,e.useFlateDecode=!!window.pako||!!window.fflate,e.deflate=function(t){var e=t;if(window.pako)return window.pako.deflate(e);if(window.fflate){if("string"==typeof e)e=(new TextEncoder).encode(e);return window.fflate.zlibSync(e)}return e}}function P(){}function b(){this.pages=[]}function C(t,e,i,o){this.pdf=t,this.fonts=[],this.images=[],this.fillImages=[],this.alphas=[],this.fillColor="0 0 0 ",this.strokeColor="0 0 0 ",this.lineWidth=2,this.lineCap=0,this.lineJoin=1,this.fontSize=12,this.font="normal",this.width=72*e,this.height=72*i,this.pagesID=o,this._ctm=[1,0,0,1,0,0]}function v(t){const e=t.unicodes.map(((t,e)=>`<${O.toHex(e)}><${O.toHex(t)}>`)).join("\n");this.stream=`/CIDInit /ProcSet findresource begin\n                       10 dict begin\n                       begincmap\n                       /CIDSystemInfo\n                       << /Registry (Adobe)\n                       /Ordering (UCS)\n                       /Supplement 0\n                       >> def\n                       /CMapName /Adobe-Identity-UCS def\n                       /CMapType 2 def\n                       1 begincodespacerange\n                       <0000> <FFFF>\n                       endcodespacerange\n                       ${t.unicodes.length} beginbfchar\n                       ${e}\n                       endbfchar\n                       endcmap\n                       CMapName currentdict /CMap defineresource pop\n                       end\n                       end`}function T(){}function S(){}function w(t){this.buffer=atob(t.base64)}function F(t){this.fontName=t,this.descendantFonts=[],this.subtype="Type1",this.encoding="WinAnsiEncoding"}function I(){this.stream=""}e.PdfContext=function(t,e,i){var o=this,n=new x;this.doc=n;var r=document.createElement("canvas");this.context=r.getContext("2d"),n.pageSetWidth(t/72),n.pageSetHeight(e/72),n.addPage(i);var s="10px Helvetica";this.textAlign="left",this.textBaseline="alphabetic";Object.defineProperty(this,"fillStyle",{get:function(){return this.fillColor},set:function(t){if(this.fillColor=t,t instanceof k)console.log("TODO",o.doc);else if(t.toString().startsWith("rgb")||t.toString().startsWith("hsl")){var e=y(t);o.doc.fillColor(e.c,e.a)}}}),Object.defineProperty(this,"strokeStyle",{get:function(){return o.doc.strokeColor()},set:function(t){var e=y(t);o.doc.strokeColor(e.c,e.a)}}),Object.defineProperty(this,"lineWidth",{get:function(){return o.doc.setLineWidth()},set:function(t){o.doc.setLineWidth(t)}}),Object.defineProperty(this,"lineCap",{get:function(){return"butt"},set:function(t){o.doc.lineCap(t)}}),Object.defineProperty(this,"lineJoin",{get:function(){return"miter"},set:function(t){o.doc.lineJoin(t)}}),Object.defineProperty(this,"miterLimit",{get:function(){return 10},set:function(){}}),Object.defineProperty(this,"globalAlpha",{get:function(){return o.doc.opacity()},set:function(t){o.doc.opacity(t)}}),Object.defineProperty(this,"font",{get:function(){return s},set:function(t){this.context.font=t,s=t;var e,i,n=((i=(e=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\'\"\sa-z0-9]+?)\s*$/i).exec(o.font))||(console.log("error parsing font "+o.font),i=e.exec("10px Helvetica")),i[6].indexOf("sans-serif")>-1&&(i[6]="Helvetica"),i[6].indexOf("serif")>-1&&(i[6]="Times-Roman"),{style:i[1]||"normal",size:parseInt(i[4])||10,family:i[6]||"Helvetica",weight:i[3]||"normal"});o.doc.fontSize(n.size),o.doc.font(n.family),o.doc.setFontStyle("normal"!=n.weight,"normal"!=n.style,!1)}}),this.font=s,this.strokeStyle="rgb(0,0,0)",this.fillStyle="rgb(0,0,0)"},e.PdfContext.prototype.end=function(){this.doc.end()},e.PdfContext.prototype.addPage=function(t){this.doc.addPage(t)},e.PdfContext.prototype.save=function(){this.doc.save()},e.PdfContext.prototype.restore=function(){this.doc.restore()},e.PdfContext.prototype.transform=function(t,e,i,o,n,r){this.doc.transform(t,e,i,o,n,r)},e.PdfContext.prototype.scale=function(t,e){this.doc.scale(t,e)},e.PdfContext.prototype.rotate=function(t){var e=180*t/Math.PI;this.doc.rotate(e)},e.PdfContext.prototype.translate=function(t,e){this.doc.translate(t,e)},e.PdfContext.prototype.beginPath=function(){this.doc.beginPath()},e.PdfContext.prototype.moveTo=function(t,e){this.doc.moveTo(t,e)},e.PdfContext.prototype.closePath=function(){this.doc.closePath()},e.PdfContext.prototype.lineTo=function(t,e){this.doc.lineTo(t,e)},e.PdfContext.prototype.stroke=function(){this.doc.stroke()},e.PdfContext.prototype.fill=function(t){this.doc.fill(t)},e.PdfContext.prototype.rect=function(t,e,i,o){this.doc.rect(t,e,i,o)},e.PdfContext.prototype.fillRect=function(t,e,i,o){this.doc.beginPath(),this.doc.rect(t,e,i,o),this.doc.fill()},e.PdfContext.prototype.strokeRect=function(t,e,i,o){this.doc.beginPath(),this.doc.rect(t,e,i,o),this.doc.stroke()},e.PdfContext.prototype.clearRect=function(t,e,i,o){var n=this.doc.fillColor();this.doc.fillColor("white"),this.doc.rect(t,e,i,o),this.doc.fill(),this.doc.fillColor(n)},e.PdfContext.prototype.arc=function(t,e,i,o,n,r){this.doc.arc(t,e,i,o,n,r)},e.PdfContext.prototype.bezierCurveTo=function(t,e,i,o,n,r){this.doc.bezierCurveTo(t,e,i,o,n,r)},e.PdfContext.prototype.quadraticCurveTo=function(t,e,i,o){this.doc.quadraticCurveTo(t,e,i,o)},e.PdfContext.prototype.createLinearGradient=function(t,e,i,o){return this.doc.linearGradient(t,e,i,o)},e.PdfContext.prototype.createRadialGradient=function(t,e,i,o,n,r){var s=this.doc.radialGradient(t,e,i,o,n,r);return s.addColorStop=function(t,e){var i=y(e);s.stop(t,i.c,i.a)},s},e.PdfContext.prototype.fillText=function(t,e,i){t&&t.trim().length&&this.doc.textAdd(e,i,t)},e.PdfContext.prototype.strokeText=function(){console.log("strokeText not implemented, use fillText")},e.PdfContext.prototype.measureText=function(t){return this.context.measureText(t+"")},e.PdfContext.prototype.clip=function(){this.doc.clip()},e.PdfContext.prototype.getPDFbase64=function(){return this.doc.getBase64Text()},e.PdfContext.prototype.getPDFtext=function(){return this.doc.getText()},e.PdfContext.prototype.drawImage=function(t,e,i,o,n){var r=this.doc.currentPage._ctm,s=r[0]*r[3]-r[1]*r[2];return this.doc.drawImage(t,e,i,o,n,Math.sqrt(Math.abs(s)))},e.PdfContext.prototype.setLineDash=function(t){return this.doc.setLineDash(t)},e.PdfContext.prototype.createPattern=function(t){var e=this.doc.imageTileLoad(t);return{setTransform:t=>{e.matrix=t}}},e.PdfContext.prototype.setTransform=function(){console.log("setTransform not implemented")},e.PdfContext.prototype.drawFocusRing=function(){console.log("drawFocusRing not implemented")},e.PdfContext.prototype.createImageData=function(){console.log("drawFocusRing not implemented")},e.PdfContext.prototype.getImageData=function(){console.log("getImageData not implemented")},e.PdfContext.prototype.putImageData=function(){console.log("putImageData not implemented")},e.PdfContext.prototype.globalCompositeOperation=function(){console.log("globalCompositeOperation not implemented")},e.PdfContext.prototype.arcTo=function(){console.log("arcTo not implemented")},x.prototype.add=function(t){return this.objects.push(t),t.id=this.objects.length,t},x.prototype.pageSetWidth=function(t){this.pageWidth=t},x.prototype.pageSetHeight=function(t){this.pageHeight=t},x.prototype.addPage=function(t){this.currentPage=new C(this,this.pageWidth,this.pageHeight,this.pages.id),this.currentPage.dpi=t?.dpi||72,this.add(this.currentPage),this.pages.addPage(this.currentPage);var e=new I;this.add(e),this.currentPage.setStream(e),t&&t.verticalFlip||this.currentPage.transform(1,0,0,-1,0,this.currentPage.height)},x.prototype.font=function(t){this.currentPage.setFontName(t)},x.prototype.fontSize=function(t){this.currentPage.setFontSize(t)},x.prototype.lineJoin=function(t){this.currentPage.setLineJoin(t)},x.prototype.lineCap=function(t){this.currentPage.setLineCap(t)},x.prototype.setLineWidth=function(t){this.currentPage.setLineWidth(t)},x.prototype.strokeColor=function(t,e){this.currentPage.setStrokeColor(t,e)},x.prototype.fillColor=function(t,e){this.currentPage.setFillColor(t,e)},x.prototype.pageSetCurrent=function(t){this.currentPage=t},x.prototype.font=function(t){this.textStyle.setFontName(t)},x.prototype.fontSetSize=function(t){this.textStyle.fontSetSize(t)},x.prototype.setFontStyle=function(t,e){this.textStyle.setFontStyle(t,e)},x.prototype.setFont=function(t){var n=t.getFontName();if(null!=n){var r,s=null;for(r=0;r<this.fonts.length;r++)this.fonts[r].fontName==n&&(s=this.fonts[r]);if(null==s&&(s=new F(n),this.add(s),this.fonts.push(s),n.startsWith("Roboto"))){s.subtype="Type0";const t=this.add(new F("Unicode"));if(s.baseFont="Unicode",s.spec=t.spec=o[n],!s.spec){i.add(n);const t=document.createElement("script");throw t.src=e.fontPath+n.split("-")[0]+".js",document.head.append(t),new Error("Font not loaded: "+n)}t.subtype="CIDFontType2",t.cidToGidMap="Identity",t.ratio=n.includes("Serif")?1:.65,this.fonts.push(t),s.descendantFonts.push(t),s.encoding="Identity-H",s.toUnicode=this.add(new v(s.spec)),t.fontDescriptor=this.add(new S),t.fontDescriptor.spec=s.spec,t.systemInfo=this.add(new T),t.fontDescriptor.fontFile=this.add(new w(s.spec))}t.setFont(s)}},x.prototype.textAdd=function(t,e,i){var o=this.textStyle.clone();(this.currentPage.isUnicode||[...i].find((t=>t.charCodeAt(0)>127)))&&(o.setFontName(o.fontName.startsWith("Times")?"RobotoSerif":"Roboto"),this.currentPage.isUnicode=!0),this.setFont(o),this.currentPage.textAdd(t,e,i,o)},x.prototype.imageLoadFromCanvas=function(t,e){(t=new R(t)).scale=e,this.add(t),t.mask&&this.add(t.mask),this.currentImage=t},x.prototype.imageTileLoadFromCanvas=function(t){return(t=new M(t,this.currentPage.fillColor,1*this.currentPage.alpha)).vectorPattern&&this.add(t.vectorPattern),this.add(t),this.currentPage.currentImageTile=t,t},x.prototype.linearGradient=function(t,e,i,o){var n=new k(t,e,i,o,this.currentPage);return this.add(n),this.currentPage.currentImageTile=n,this.addPatternToPage(n),n},x.prototype.doDrawImage=function(t,e,i,o){this.currentPage.drawImage(t,e,this.currentImage,this.alpha,i,o)},x.prototype.addPatternToPage=function(t){this.currentPage.addPatternToPage(t)},x.prototype.moveTo=function(t,e){this.currentPage.moveTo(t,e)},x.prototype.lineTo=function(t,e){this.currentPage.lineTo(t,e)},x.prototype.bezierCurveTo=function(t,e,i,o,n,r){this.currentPage.bezierCurveTo(t,e,i,o,n,r)},x.prototype.translate=function(t,e){this.currentPage.translate(t,e)},x.prototype.transform=function(t,e,i,o,n,r){this.currentPage.transform(t,e,i,o,n,r)},x.prototype.drawImage=function(t,e,i,o,n,r){var s=1;if("img"==t.nodeName.toLowerCase()){var a=document.createElement("canvas");t.src.startsWith&&t.src.startsWith("data:image/svg")&&(s=2*Math.max(1,r||1)*this.currentPage.dpi/72),a.width=t.width*s,a.height=t.height*s,a.getContext("2d").drawImage(t,0,0,t.width,t.height,0,0,a.width,a.height),t=a}this.imageLoadFromCanvas(t,s),this.doDrawImage(e,i,t.width,t.height)},x.prototype.imageTileLoad=function(t){if(t.nodeName&&"img"==t.nodeName.toLowerCase()){var e=document.createElement("canvas");e.width=t.width,e.height=t.height,e.getContext("2d").drawImage(t,0,0),t=e}var i=this.imageTileLoadFromCanvas(t);return this.addPatternToPage(this.currentPage.currentImageTile),i},x.prototype.scale=function(t,e,i){this.currentPage.scale(t,e,i)},x.prototype.rotate=function(t,e){this.currentPage.rotate(t,e)},x.prototype.beginPath=function(){this.currentPage.beginPath()},x.prototype.arc=function(t,e,i,o,n,r){this.currentPage.arc(t,e,i,o,n,r)},x.prototype.closePath=function(){this.currentPage.closePath()},x.prototype.stroke=function(){this.currentPage.stroke()},x.prototype.clip=function(t){this.currentPage.clip(t)},x.prototype.opacity=function(t){if(void 0===t)return this.currentPage.currentAlpha;this.currentPage.setAlpha(t)},x.prototype.setLineDash=function(t){this.currentPage.setLineDash(t)},x.prototype.save=function(){this.currentPage.saveContext()},x.prototype.restore=function(){this.currentPage.restoreContext()},x.prototype.fill=function(t){this.currentPage.fill(t)},x.prototype.rect=function(t,e,i,o){this.currentPage.rect(t,e,i,o)},x.prototype.quadraticCurveTo=function(t,e,i,o){this.currentPage.quadraticCurveTo(t,e,i,o)},x.prototype.graphicsSetAlpha=function(t){this.alpha=Math.floor(100*t/255)/100,this.textStyle.setAlpha(t)},x.prototype.graphicsSetLineEndType=function(t){this.lineEndType=t},x.prototype._write=function(t){this.stream+=t+"\n"},x.prototype.getObject=function(t){var e,i;for(this.stream="",this._write("%PDF-1.7"),e=0;e<this.objects.length;e++)(i=this.objects[e]).offset=this.stream.length,i=i.getObject(this,t),this._write(i);t=this.stream.length,this._write("xref"),this._write("0 "+(this.objects.length+1)),this._write("0000000000 65535 f");var o=this.objects;for(e=0;e<o.length;e++){var n=this.objects[e].offset;n=("0000000000"+n).slice(-10),this._write(n+" 00000 n")}return this._write("trailer"),this._write(O.convert({Size:this.objects.length+1,Root:j.of(this.catalog)})),this._write("startxref"),this._write(t),this._write("%%EOF"),this.stream},x.prototype.getBase64Text=function(){return"data:application/pdf;base64,"+btoa(this.getObject(this))},P.prototype.setPages=function(t){this.props={Type:"Catalog",Pages:j.of(t)}},P.prototype.getObject=function(){return O.makeObject(this.props,this.id)},b.prototype.addPage=function(t){return this.pages.push(t),t.setPageNumber(this.pages.length),t},b.prototype.getObject=function(){for(var t="[",e=0;e<this.pages.length;e++)t+=this.pages[e].id,t+=" 0 R ";t+="]";var i={Type:"Pages",Count:this.pages.length,Kids:new j(t)};return O.makeObject(i,this.id)},C.prototype.setStream=function(t){this.pdfStream=t},C.prototype.setPageNumber=function(t){this.pageNumber=t},C.prototype.textAdd=function(t,e,i,o){var n=this.fontSize;-1==this.fonts.indexOf(o.font)&&this.fonts.push(o.font),i=O.convert(new String(i),o.font.spec),this.setAlpha(o.alpha),e=this.height-e,this.saveContext(),this.transform(1,0,0,-1,0,this.height),this.pdfStream.addText("BT "+this.strokeColor+" rg /F"+o.font.id+" "+n+" Tf 1 0 0 1 "+t+" "+e+" cm "+i+"Tj ET "),this.restoreContext()},C.prototype.setAlpha=function(t){var e=1*t;if(this.currentAlpha!=e){-1==this.alphas.indexOf(e)&&this.alphas.push(e);var i=this.alphas.indexOf(e);this.pdfStream.addText("/Alpha"+i+" gs "),this.currentAlpha=e}},C.prototype.moveTo=function(t,e){this.pdfStream.addText(t+" "+e+" m ")},C.prototype.setLineWidth=function(t){this.lineWidth=t},C.prototype.lineTo=function(t,e){this.pdfStream.addText(t+" "+e+" l ")},C.prototype.bezierCurveTo=function(t,e,i,o,n,r){this.pdfStream.addText(t+" "+e+" "+i+" "+o+" "+n+" "+r+" c ")},C.prototype.transform=function(t,e,i,o,n,r){var s,a,h,c,p,d,f,u,l;a=(s=this._ctm)[0],h=s[1],c=s[2],p=s[3],d=s[4],f=s[5],s[0]=a*t+c*e,s[1]=h*t+p*e,s[2]=a*i+c*o,s[3]=h*i+p*o,s[4]=a*n+c*r+d,s[5]=h*n+p*r+f,l=function(){var s,a,h,c;for(c=[],s=0,a=(h=[t,e,i,o,n,r]).length;s<a;s++)u=h[s],c.push(+u.toFixed(5));return c}().join(" "),this.pdfStream.addText(l+" cm ")},C.prototype.translate=function(t,e){this.transform(1,0,0,1,t,e)},C.prototype.rotate=function(t,e){var i,o,n,r,s,a,h;null==e&&(e={}),o=t*Math.PI/180,i=Math.cos(o),n=Math.sin(o),r=s=0,null!=e.origin&&(a=(r=(h=e.origin)[0])*n+(s=h[1])*i,r-=r*i-s*n,s-=a),this.transform(i,n,-n,i,r,s)},C.prototype.scale=function(t,e,i){var o,n,r;null==e&&(e=t),null==i&&(i={}),o=n=0,null!=i.origin&&(o=(r=i.origin)[0],n=r[1],o-=t*o,n-=e*n),this.transform(t,0,0,e,o,n)},C.prototype.stroke=function(){this.pdfStream.addTextCheckMerge("S ")},C.prototype.clip=function(t){this.pdfStream.addText((/even-?odd/.test(t)?"W* ":"W ")+" n ")},C.prototype.setLineDash=function(t){this.lineDash=t},C.prototype.saveContext=function(){this.pdfStream.addText("q ")},C.prototype.restoreContext=function(){this.pdfStream.addText("Q "),this.currentAlpha=void 0},C.prototype.fill=function(t){this.currentImageTile&&(this.setAlpha(1),this.pdfStream.addText("/Pattern cs "),this.pdfStream.addText("/Pattern CS "),this.pdfStream.addText("/Paint"+this.currentImageTile.id+" scn "),this.pdfStream.addText("/Paint"+this.currentImageTile.id+" SCN "),this.currentImageTile=void 0),this.pdfStream.addTextCheckMerge(/even-?odd/.test(t)?"f* ":"f ")},C.prototype.beginPath=function(){if(this.lineDash&&this.lineDash.length){this.pdfStream.addText("[");for(var t=0;t<this.lineDash.length;t++)this.pdfStream.addText(this.lineDash[t]),this.pdfStream.addText(" ");this.pdfStream.addText("] 0 d ")}this.setAlpha(this.alpha),this.pdfStream.addText(this.fillColor+" rg "),this.pdfStream.addText(this.strokeColor+" RG "),this.pdfStream.addText(this.lineCap+" J "+this.lineJoin+" j "+(1|this.lineWidth)+" w ")},C.prototype.setStrokeColor=function(t,e){this.strokeColor=t||"0 0 0",this.alpha=e},C.prototype.setFillColor=function(t,e){this.fillColor=t||"0 0 0",this.alpha=e},C.prototype.closePath=function(){this.pdfStream.addText("h ")},C.prototype.quadraticCurveTo=function(t,e,i,o){return this.pdfStream.addText(t+" "+e+" "+i+" "+o+" v ")},C.prototype._bezierCurve=function(t,e,i,o,n,r){var s=Math.PI,a=i,h=o,c=Math.cos(n*s/180),p=Math.sin(n*s/180),d=Math.cos((n+r)*s/180),f=Math.sin((n+r)*s/180),u=t+a*c,l=e-h*p,g=-a*p,m=-h*c,y=t+a*d,x=e-h*f,P=-a*f,b=-h*d,C=Math.tan(r/2*s/180),v=Math.sin(r*s/180)*(Math.sqrt(4+3*C*C)-1)/3;return[u,l,u+v*g,l+v*m,y-v*P,x-v*b,y,x]},C.prototype.arc=function(t,e,i,o,n,r){r&&console.log("Counterclockwise not supported"),o*=180/Math.PI,n*=180/Math.PI;for(var s=i-1,a=i-1,h=Math.ceil(Math.abs(n/45)),c=o,p=n/h,d=0;d<h;d++){var f=this._bezierCurve(t,e,s,a,c,p);0==d&&this.moveTo(f[0],f[1]),this.bezierCurveTo(f[2],f[3],f[4],f[5],f[6],f[7]),c+=p}},C.prototype.rect=function(t,e,i,o){var n=t+i,r=e+o;this.pdfStream.addText(t+" "+e+" m "+n+" "+e+" l "+n+" "+r+" l "+t+" "+r+" l "+t+" "+e+" l ")},C.prototype._CAP_STYLES={BUTT:0,ROUND:1,SQUARE:2},C.prototype.setLineCap=function(t){"string"==typeof t&&(t=this._CAP_STYLES[t.toUpperCase()]),this.lineCap=t},C.prototype._JOIN_STYLES={MITER:0,ROUND:1,BEVEL:2},C.prototype.setLineJoin=function(t){"string"==typeof t&&(t=this._JOIN_STYLES[t.toUpperCase()]),this.lineJoin=t},C.prototype.setFontSize=function(t){this.fontSize=t},C.prototype.transform=function(t,e,i,o,n,r){var s,a,h,c,p,d,f,u,l;a=(s=this._ctm)[0],h=s[1],c=s[2],p=s[3],d=s[4],f=s[5],s[0]=a*t+c*e,s[1]=h*t+p*e,s[2]=a*i+c*o,s[3]=h*i+p*o,s[4]=a*n+c*r+d,s[5]=h*n+p*r+f,l=function(){var s,a,h,c;for(c=[],s=0,a=(h=[t,e,i,o,n,r]).length;s<a;s++)u=h[s],c.push(+u.toFixed(5));return c}().join(" "),this.pdfStream.addText(l+" cm ")},C.prototype.drawImage=function(t,e,i,o,n,r){var s=i.scale||1;this.saveContext(),this.transform(1,0,0,-1,0,0),this.translate(t,-r/s-e),this.scale(n/s,r/s),this.pdfStream.addText("/Image"+i.id+" Do "),this.restoreContext(),-1==this.images.indexOf(i)&&this.images.push(i)},C.prototype.addPatternToPage=function(t){-1==this.fillImages.indexOf(t)&&this.fillImages.push(t)},C.prototype.getObject=function(t){t.pageSetCurrent(this);var e={Type:"Page"};e.Parent=new j(this.pagesID+" 0 R"),e.MediaBox=[0,0,this.width,this.height],e.Contents=j.of(this.pdfStream);var i={};if(this.fonts.length>0)for(var o=0;o<this.fonts.length;o++){var n=this.fonts[o];i["F"+n.id]=j.of(n)}var r={};if(this.alphas.length>0)for(o=0;o<this.alphas.length;o++){var s=this.alphas[o];(isNaN(s)||void 0===s)&&(s="1"),"string"==typeof s&&(s*=1),r["Alpha"+o]={CA:s,ca:s}}var a={};if(this.images.length>0)for(var h=0;h<this.images.length;h++)a["Image"+(n=this.images[h]).id]=j.of(n);var c={};if(this.fillImages.length>0)for(h=0;h<this.fillImages.length;h++)c["Paint"+(n=this.fillImages[h]).id]=j.of(n);return e.Resources={},this.fonts.length>0&&(e.Resources.Font=i),this.alphas.length>0&&(e.Resources.ExtGState=r),this.fillImages.length>0&&(e.Resources.Pattern=c),this.images.length>0&&(e.Resources.XObject=a),O.makeObject(e,this.id)},v.prototype.getObject=function(){var t=D(this.stream),e={Length:t.length};return O.makeObject(e,this.id,t)},T.prototype.getObject=function(){const t={Supplement:0,Registry:new j("(Adobe)"),Ordering:new j("(Identity)")};return O.makeObject(t,this.id)},S.prototype.getObject=function(){const t={CapHeight:939,StemV:56,FontBBox:this.spec.bbox,FontFile2:j.of(this.fontFile),Descent:this.spec.bbox[2],Type:"FontDescriptor",Flags:32,FontName:"Unicode",ItalicAngle:0,Ascent:this.spec.bbox[3]};return O.makeObject(t,this.id)},w.prototype.getObject=function(){const t={Length:this.buffer.length,Length1:this.buffer.length};return O.makeObject(t,this.id,this.buffer)},F.TIMES=["Times-Roman","Times-Italic","Times-Bold","Times-BoldItalic"],F.HELVETICA=["Helvetica","Helvetica-Oblique","Helvetica-Bold","Helvetica-BoldOblique"],F.ROBOTO=["Roboto-Regular","Roboto-Italic","Roboto-Bold","Roboto-BoldItalic"],F.ROBOTO_SERIF=["RobotoSerif-Regular","RobotoSerif-Italic","RobotoSerif-Bold","RobotoSerif-BoldItalic"],F.getPDFName=function(t,e,i){var o=(e?2:0)+(i?1:0);return"Helvetica"==t?F.HELVETICA[o]:"Roboto"==t?F.ROBOTO[o]:"RobotoSerif"==t?F.ROBOTO_SERIF[o]:F.TIMES[o]},F.prototype.getObject=function(){var t={Subtype:this.subtype,Name:"F"+this.id,BaseFont:this.baseFont||this.fontName,Encoding:this.encoding,Type:"Font",DescendantFonts:this.descendantFonts.map((t=>j.of(t)))};return this.toUnicode&&(t.ToUnicode=j.of(this.toUnicode)),this.systemInfo&&(t.CIDSystemInfo=j.of(this.systemInfo)),this.fontDescriptor&&(t.FontDescriptor=j.of(this.fontDescriptor)),this.cidToGidMap&&(t.FontMatrix=this.spec.matrix,t.FontBBox=this.spec.bbox,t.W=new j("["+this.spec.widths.map(((t,e)=>t&&e?`${e} [${t*this.ratio}]`:"")).join("")+"]"),t.CIDToGIDMap=this.cidToGidMap),O.makeObject(t,this.id)},I.prototype.addText=function(t){this.stream+=t},I.prototype.addTextCheckMerge=function(t){function e(t,e){return-1!==t.indexOf(e,t.length-e.length)}"f* "==t&&e(this.stream," S ")?this.stream=this.stream.substring(0,this.stream.length-3)+" B* ":"S "==t&&e(this.stream," f* ")?this.stream=this.stream.substring(0,this.stream.length-4)+" B* ":"f "==t&&e(this.stream," S ")||"S "==t&&e(this.stream," f ")?this.stream=this.stream.substring(0,this.stream.length-3)+" B ":this.stream+=t},I.prototype.replaceText=function(t,e){this.stream=this.stream.replace(t,e)},I.prototype.getObject=function(){var t=D(this.stream),i={Length:t.length};return e.useFlateDecode&&(i.Filter="FlateDecode"),O.makeObject(i,this.id,t)};var O,j,D=function(t){if(e.useFlateDecode)t=e.deflate(t);else if("string"==typeof t)return t;for(var i=[],o=0;o<t.length;o++)i.push(String.fromCharCode(t[o]));return i.join("")};function R(t,e){this.width=t.width,this.height=t.height,this.isMask=!!e,e?this.stream=D(e):this.loadData(t)}function k(t,e,i,o,n){this.page=n,this.x1=t,this.y1=e,this.x2=i,this.y2=o,this.cols=["white","black"]}function B(t,e){this.stream=t,this.boundingBox=e}function M(t,i,o){if(t.getContext){this.width=t.width,this.height=t.height,this.boundingBox=[0,0,this.width,this.height];for(var n=[this.width+" 0.0000 0.0000 -"+this.height+" 0.0000 "+this.height+" cm ","BI ","/Width "+this.width+" ","/Height "+this.height+" ","/ColorSpace /DeviceRGB ","/BitsPerComponent 8 "],r=t.getContext("2d").getImageData(0,0,this.width,this.height),s=i.split(" ").map((t=>t*(1-o)+o)),a=new Uint8Array(this.width*this.height*3),h=0,c=this.height-1;c>=0;c--)for(var p=0;p<this.width;p++){var d=r.data[4*(p+c*this.width)],f=r.data[4*(p+c*this.width)+1],u=r.data[4*(p+c*this.width)+2],l=r.data[4*(p+c*this.width)+3];[d,f,u]=[d,f,u].map(((t,e)=>Math.round(parseFloat(t)/255*l+s[e]*(255-l)))),a[h++]=d,a[h++]=f,a[h++]=u}e.useFlateDecode&&n.push("/Filter /FlateDecode "),this.stream=n.join("")+"ID\n"+D(a)+"\nEI\n"}else{var g=t.doc.currentPage;this.boundingBox=t.boundingBox||[0,0,72*g.pdf.pageWidth,72*g.pdf.pageHeight],this.alphas=g.alphas,this.vectorPattern=new B(g.pdfStream.stream,this.boundingBox)}}function A(){this.fontName="Helvetica",this.fontSize=12,this.italic=!1,this.bold=!1,this.font=void 0,this.alpha=1}R.prototype.loadData=function(t){for(var e=t.getContext("2d"),i=new Uint8Array(this.height*this.width*3),o=e.getImageData(0,0,this.width,this.height),n=0,r=new Uint8Array(this.height*this.width),s=0,a=!1,h=0;h<this.height;h++)for(var c=0;c<this.width;c++){var p=o.data[4*(c+h*this.width)],d=o.data[4*(c+h*this.width)+1],f=o.data[4*(c+h*this.width)+2],u=o.data[4*(c+h*this.width)+3];i[n++]=p,i[n++]=d,i[n++]=f,r[s++]=u,255!=u&&(a=!0)}a&&(this.mask=new R(t,r)),this.stream=D(i)},R.prototype.writeImage=function(t){this.stream=t},R.prototype.getObject=function(){var t={Type:"XObject",Width:this.width,Height:this.height,Subtype:"Image",ColorSpace:this.isMask?"DeviceGray":"DeviceRGB",BitsPerComponent:8,Name:"Image"+this.id,Length:this.stream.length};return this.mask&&(t.SMask=j.of(this.mask)),e.useFlateDecode&&(t.Filter="FlateDecode"),O.makeObject(t,this.id,this.stream)},k.prototype.addColorStop=function(t,e){0!=t&&1!=t&&console.error("only 0 and 1 supported for addColorStop",t),this.cols[Math.round(t)]=e},k.prototype.getObject=function(){var t=y(this.cols[0]).c.split(" "),e=y(this.cols[1]).c.split(" "),i={Type:"Pattern",PatternType:2,Shading:{ShadingType:2,Extend:[!0,!0],Coords:[this.x1,this.page.height-this.y1,this.x2,this.page.height-this.y2],ColorSpace:"DeviceRGB",Function:{FunctionType:2,N:1,Domain:[0,1],C0:[1*t[0],1*t[1],1*t[2]],C1:[1*e[0],1*e[1],1*e[2]]}}};return O.makeObject(i,this.id,this.stream)},B.prototype.getObject=function(){var t={Type:"XObject",Subtype:"Form",BBox:this.boundingBox};return O.makeObject(t,this.id,this.stream)},M.prototype.writeImage=function(t){this.stream=t},M.prototype.getObject=function(){var t={},e=[this.matrix?this.matrix.m11:1,0,0,this.matrix?this.matrix.m22:1,0,0];this.vectorPattern&&(this.stream=`/x${this.vectorPattern.id} Do`,t[`x${this.vectorPattern.id}`]=j.of(this.vectorPattern),e=[1,0,0,-1,0,0]);var i={Type:"Pattern",PatternType:1,PaintType:1,TilingType:1,BBox:this.boundingBox,XStep:this.boundingBox[2]-this.boundingBox[0],YStep:this.boundingBox[3]-this.boundingBox[1],Length:this.stream.length,Matrix:e,Resources:this.vectorPattern?{XObject:t}:{ProcSet:["PDF","ImageC"]}};return O.makeObject(i,this.id,this.stream)},A.prototype.setFontName=function(t){this.fontName=t,this.font=void 0},A.prototype.fontSetSize=function(t){this.fontSize=t},A.prototype.setFontStyle=function(t,e){this.bold=t,this.italic=e},A.prototype.setColor=function(t){this.color=t},A.prototype.setAlpha=function(t){this.alpha=t},A.prototype.getFontName=function(){return F.getPDFName(this.fontName,this.bold,this.italic)},A.prototype.setFont=function(t){this.font=t},A.prototype.clone=function(){var t=new A;return t.fontName=this.fontName,t.fontSize=this.fontSize,t.bold=this.bold,t.italic=this.italic,t.color=this.color,t.alpha=this.alpha,t.font=this.font,t},O=function(){var t,e,i;function o(){}return i=function(t,e){return(Array(e+1).join("0")+t).slice(-e)},e=/[\n\r\t\b\f()\\]/g,t={"\n":"\\n","\r":"\\r","\t":"\\t","\b":"\\b","\f":"\\f","\\":"\\\\","(":"\\(",")":"\\)"},o.makeObject=function(t,e,i){var n=e+" 0 obj\n"+o.convert(t);return i&&(n+="\nstream\n"+i+"\nendstream\n"),n+="endobj\n"},o.toHex=function(t){return t.toString(16).padStart(4,"0")},o.fromUnicode=function(t,e){const i=e.unicodes.indexOf(t);return i<=0?e.unicodes.indexOf(63):i},o.convert=function(n,r){var s,a,h,c,p,d,f,u;if("string"==typeof n)return"/"+n;if(n instanceof String){p=n;if(!!r||[...p].find((t=>t.charCodeAt(0)>127))){var l="";for(a=f=0,u=p.length;f<u;a=f+=1){l+=o.toHex(o.fromUnicode(p.codePointAt(a),r))}return"<"+l+">"}return"("+(p=n.replace(e,(function(e){return t[e]})))+")"}if(n instanceof j)return n.toString();if(n instanceof Date)return"(D:"+i(n.getUTCFullYear(),4)+i(n.getUTCMonth()+1,2)+i(n.getUTCDate(),2)+i(n.getUTCHours(),2)+i(n.getUTCMinutes(),2)+i(n.getUTCSeconds(),2)+"Z)";if(Array.isArray(n))return"["+function(){var t,e,i;for(i=[],t=0,e=n.length;t<e;t++)s=n[t],i.push(o.convert(s));return i}().join(" ")+"]";if("[object Object]"==={}.toString.call(n)){for(h in c=["<<"],n)d=n[h],c.push("/"+h+" "+o.convert(d)+"\n");return c.push(">>"),c.join("")+"\n"}return""+n},o}(),j=function(){function t(t){this.str=t}return t.prototype.toString=function(){return this.str},t.of=function(e){return new t(e.id+" 0 R")},t}()}("undefined"!=typeof window?window:this);